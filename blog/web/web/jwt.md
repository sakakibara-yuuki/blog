---
title: 'JWT認証'
author: "sakakibara"
description: 'Lorem ipsum dolor sit amet'
heroImage: '/blog-placeholder-3.jpg'
pubDate: 2024-10-14
tags: ["astro", "math"]
---

# Introduction
## Contents
## セッションの仕組み
### Cookieベースのセッション
Webアプリでよく使用される方法.
クライアントがログインすると, サーバーはセッションIDを生成し, それをクッキーとしてクライアントに返す.
クライアントはその後のあらゆるリクエストでそのCookieをサーバーに送信し, サーバーはそのセッションIDに基づいて認証を行う.
### トークンベースの認証（JWT）
クライアントが認証されると, サーバーは署名付きのトークンを生成し, それをクライアントに返す.
クライアントはそのトークンをリクエストの`Authorization`ヘッダーに含めてサーバーに送信する. サーバーはそのトークンを検証し, リクエストを処理する.
### OAuth2.0
主に外部サービスやソーシャルログインで利用される認証プロトコル.(第三者がいる)
セッション管理にも使うことができる.
OAuth2.0を使用すると, クライアントはアクセストークンを取得し, それを使ってAPIにリクエストを送信する. 

### Cookieベースのトークンベースの違い
Cookieベースのセッションもトークンベースの認証も, どちらもクライアント固有の情報(セッションIDまたはトークン)をサーバーに送り, それをサーバーが検証することで認証を行う.
この点ではCookieベースのセッションもトークンベースの認証も同じである.
しかし, この２つには違いがある.

1. ステートフル vs ステートレス
cookieベースのセッションはサーバー側でセッション情報を保持するため, ステートフルである.
クライアントはセッションIDを送信し, それをサーバー内に保存されているセッションデータを参照する.
つまり, サーバー側にセッションストレージが必要となる.
そのため, サーバーが複数ある場合, セッションデータを共有するための仕組みが必要となる.

対して, トークンベースの認証はステートレスである.
トークン自体に認証情報が含まれており, サーバーはそのトークンを検証して認証を行う.
このため, サーバーはセッションデータを保持する必要がないため, 複数のサーバー間でトークンの検証が可能である.

2. トークンの情報
CookieベースのセッションでのセッションIDは通常短い識別子に過ぎず, サーバー側で保存されているセッションデータと関連付けられる.
このため, クライアントには認証情報が渡されないため, クライアント側でセッションの状態を確認することはできない.

対して, トークンベースの認証ではトークン自体にユーザー情報や認証に必要な情報が含まれている.
そのため, サーバーはトークンを解析するだけで, ユーザーの認証状態や権限を確認することができ, クライアント側でもトークンを解析するだけで, 自分の認証状態を確認することができる.

3. サーバーの負荷とスケーラビリティ
Cookieベースのセッションはサーバー側でセッションデータを保持するため, サーバーの負荷が増加する.
さらに, サーバーが複数ある場合, セッションデータを共有するための仕組みが必要となる.

対して, トークンベースの認証はステートレスであるため, サーバー側でセッションデータを保持する必要がない.
このため, スケーリングが容易であり, 複数のサーバー間で認証情報の一貫性が保証され, サーバー間での同期は不要となる.

4. セキュリティ (なりすまし / 改ざん)
Cookieベースのセッションは　XSS（クロスサイトスクリプティング）やCSRF（クロスサイトリクエストフォージェリ）などの攻撃に対して脆弱である.
つまり, クライアントがセッションIDを盗まれると, サーバーになりすましてリクエストを送信することができる.
また, 改ざんされたCookieを使ってなりすましを行うことも可能である.
`HttpOnly`や`Secure`属性を設定して, セキュリティを強化することができるが, 完全に防ぐことは難しい.
しかし, セッションIDはサーバー側で管理されているため, 盗聴がバレた場合, サーバー側でセッションIDを無効化することが簡単である.

対して, トークンベースの認証は, トークンがクライアントに保持されるため, トークンが漏洩した場合, そのトークンを使ってなりすましを行うことができる. そのため, トークンは定期的に更新するなどの対策が必要である.
また, トークンはサーバー側で管理していないため, 不正なアクセスであったとしても, サーバー側でトークンを無効化することが難しい.

ただ, トークンは署名されているため, トークンが改ざんされた場合, サーバー側で検証することができ, トークンの信頼性を確認することができる.

## XSSとCSRF
## 署名のしくみ
## 文脈維持の方法
## JWT
## session
## 参考　
- [JWT認証の流れを理解する #初学者向け](https://qiita.com/asagohan2301/items/cef8bcb969fef9064a5c)
- [一番分かりやすい OAuth の説明 #OAuth](https://qiita.com/TakahikoKawasaki/items/e37caf50776e00e733be)

