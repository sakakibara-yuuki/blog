---
title: 'REST APIとは'
author: "sakakibara"
description: 'Lorem ipsum dolor sit amet'
heroImage: '/blog-placeholder-3.jpg'
pubDate: 2024-08-13
tags: ["REST", "web", "API", "設計"]
---

# Introduction
Web APIの設計スタイルの一つであるREST APIについて解説する.
<!-- Udemyの[RESTの概念、設計思想を学び、OpenAPI Swagger を利用した REST Web API サービス設計を行います](https://www.udemy.com/course/rest-webapi-development/)を参考にしたが, この動画は極端にわかりにくかった. -->
<!-- 言葉の定義が曖昧で, まとまりが悪い. -->
<!-- REST APIについて曖昧にしか説明されていなかった. -->
<!-- おそらく作者の理解が浅いためだと思われる. -->

### RESTとは何か.  
以下は参考資料には語られてはいないが, REST APIについて, 自分なりの解釈, 見解を述べる.

---
RESTとは, RESTの制約に則って設計されたWeb APIのことである.  
細かい内容については後ろの章で解説するが, RESTの制約は主に
- クライアント/サーバー
- 階層化システム
- コードオンデマンド
- 統一インターフェース
- ステートレス
- キャッシュ制御

である.


逆説的になるが, RESTの制約を充たすことがREST API設計の目的である.  
つまり, 各REST制約のメリットがREST APIのメリットそのものになる.  
それらメリットは互いに重複している部分もあるし, 互いに補完し合っている部分もある
(例えば, 保守性や拡張性の向上という点ではクライアントサーバーと階層化システムによって得られるメリットである).  
そして各REST制約のメリットを大雑把にまとめてしまうと,
システム間を疎結合にすることで, 保守性と拡張性を向上させ, 予測可能なインターフェースを提供することに集約される.

また, REST APIでは, GETメソッドが安全であること, PUT, DELETEメソッドが冪等であることが求められる(制約を充たすことで同時に充たされる).

---

## Contents
## Web API
RESTとはWeb APIの設計スタイルの一つである.
では, そもそもWeb APIとは何だろうか.

<section style="border: 1px solid black; border-radius: 8px; padding-left: 1rem; padding-right: 1rem;">
<p><strong>Web APIとは</strong></p>

Web APIとはHTTPなどのプロトコルを使って**プログラムが読み書きしやすい**形式でメッセージ送受信を行えるように定義された**規約**. または, その規約にしたがって作られるAPI/サービスのこと.
</section>

Web APIのよくある用途としては,
第三者がリソース(機能やデータ)を利用して新たなサービスを作成することが挙げられる. 例えば, Twitter APIを利用して, ツイートを取得するサービスを作成することができる.  

企業側はWeb APIを提供することでいくつかの利益を得ることができる.

- 新しいビジネスチャンスを生み出す:  
PayPalはAPIを提供することで, 他のウェブサイトやアプリケーションから支払いを受け取ることができる.
- エコシステムの拡大:  
SalesforceはAPIを提供することで, 他の企業がSalesforceのシステムと連携できるアプリケーションを開発できるようにした. これにより, Salesforceのプラットフォームを中心としてエコシステムが拡大されより多くの企業がSalesforceを利用するようになった.
- 顧客体験の向上:  
Google Maps APIを利用して, ウェブサイトに地図を表示することで, ユーザーがより簡単に目的地を探すことができるようになる. これによりGoogleはGoogle Mapsの利用者を増やすことができる.
- 開発者コミュニティの拡大:  
FacebookはAPIを提供することで, 開発者がFacebookのプラットフォームを利用してアプリケーションを開発できるようにした. これにより, Facebookの開発者コミュニティが拡大し, Facebookのプラットフォームを利用するアプリケーションが増えた.
- データ収集と分析の強化:  
SpotifyはAPIを通じて, 音楽の再生履歴やプレイリストを取得することができる. これにより, Spotifyはユーザーの音楽の好みを分析し, ユーザーにとってより良い音楽体験を提供することができる.

ただ, Web APIを提供することにはいくつかのリスクもある.
- ユーザーが減る.
- リソースが圧迫される.
ようなWeb APIの設計は避け, そのような状況は避けるべきである.


## 安全なWeb APIと冪等なWeb API
Web APIは何も制約が無いと, 上で挙げたようなリスクが生じる可能性がある.
そこで, 上のようなリスクを避けるようなAPIを設計するために必要な概念である **副作用**, **安全なWeb API** と, **冪等なWeb API** について解説する.
<section style="border: 1px solid black; border-radius: 8px; padding-left: 1rem; padding-right: 1rem;">
<p><strong>副作用</strong></p>

DBを更新するようなWeb APIが投げられるとDBが改変される.
このように, リソースを変化させるような作用を副作用という.
上の例とは逆に, DBの内容を取得するだけのWeb APIは副作用がない.
(なお, 厳密にはアクセスログが出力されるため, リソースにアクセスログを含めると副作用があると言える.)
</section>

副作用という用語は薬の副作用から来てる. 薬を飲むと, 本来の効果以外にも様々な効果が現れることがある. 例えば, 頭痛薬を飲むと, 頭痛が治まるだけでなく, 吐き気がすることがある. この吐き気が副作用である.

<section style="border: 1px solid black; border-radius: 8px; padding-left: 1rem; padding-right: 1rem;">
<p><strong>安全なWeb API</strong></p>

副作用が無いWeb APIを安全なWeb APIという.  
リソースを変化させない読み取り専用のWeb APIは安全なWeb APIである. より具体的には, GET, HEADメソッドを使ったWeb APIが挙げられる.
</section>

<section style="border: 1px solid black; border-radius: 8px; padding-left: 1rem; padding-right: 1rem;">
<p><strong>冪等なWeb API</strong></p>

副作用の有無を問わず, 同じリクエストを何度も投げても同じ結果が得られるWeb APIを**冪等なWeb API**という.
</section>

冪等なWeb APIは副作用の有無によらず定義されているので, 安全なWeb APIとは独立して考えることができる.

注目しているWeb APIが安全か, 冪等かの判断にはそれぞれ**副作用があるか, 2回目以降のリクエストで同じ結果が得られるか**を考えれば良い.

混乱するかもしれないが,
副作用があるWeb APIであっても, 冪等なWeb APIであることがある.
たとえば, 同じDBに対して同じデータを挿入するWeb APIは副作用がある(Web APIを投げるとDBが変化する)が, 冪等なWeb APIである(同じデータを挿入しても, 同じ結果が得られる).
同じ理屈で, 同じDBに対して同じデータを削除するWeb APIも副作用があるが, 冪等なWeb APIである.


| | 安全なWeb API | 安全ではないWeb API |
| --- | --- | --- |
| 冪等なWeb API     | データ取得 | 同じデータの更新 |
| 冪等ではないWeb API | 乱数を返す,現在時刻を返す | 新たなデータ登録 |

安全でかつ冪等ではないWeb APIは, 一般には使われない.

また, HTTPメッソッドによって安全と冪等を分別すると以下のようになる.
|メソッド | 安全 | 冪等 |
| --- | --- | --- |
| GET | ○ | ○ |
| HEAD | ○ | ○ |
| PUT | × | ○ |
| DELETE | × | ○ |
| POST | × | × |


## REST 制約と歴史
RESTとは, **RE**presentational **S**tate **T**ransferの略で, 分散型システムにおける設計原則群である.
Roy Fieldingによって2000年に博士論文で提唱された概念(Web APIの設計ルール)であり, 6つの制約により構成されている.

- nullスタート(option)
- クライアント/サーバー
- 階層化システム
- コードオンデマンド
- 統一インターフェース
- ステートレス
- キャッシュ制御

RESTの原則に従って設計されたWeb APIをRESTfulなWeb APIという.
次に, これら原則について解説する.

### クライアント/サーバー
クライアント/サーバーモデルであることがRESTの原則の一つである.

多くのWeb APIはクライアント/サーバー構造を持っている.
クライアント/サーバー構造は, クライアントがリクエストを送信し, サーバーがリクエストを受け取り, 応答を返すという構造である.
ここで肝になってくるのは, クライアントがUI(画面)を, サーバーがデータを担当するという点である. 
クライアントがトリガーとなり, サーバーが受け身の立場担っている.
いわゆる関心の分離の思想が根底にある.

### 階層化システム
階層化システムであることがRESTの原則の一つである.

階層化システムで代表的なものが, webサーバー, アプリケーションサーバー, データベースサーバーで構成される3層構造である.
ただ, 小規模なwebサービスならともかく, 中規模以上のwebサービスでは, 多くのwebサーバー, 多くのアプリケーションサーバー, 多くのデータベースサーバーで構成されることが多い.
このような複雑なシステムでは一つのサーバーをコンポーネントと呼ぶことが多い.

階層化, コンポーネント化を使うことで, システムの拡張性, 保守性が向上する.
役割を決めて独立させることで, それぞれのコンポーネントを独立して開発,運用することができる. ここにも関心の分離の思想が根底にある.

ただし, 個々のコンポーネント間で通信する必要があるため, ユーザーから見た場合のレスポンスタイムが遅くなることがある.

### コードオンデマンド
コードオンデマンドであることがRESTの原則の一つである.

コードオンデマンドとは, クライアントがサーバーからコードをダウンロードして実行することができるという機能である.

例えば, クライアントがサーバーから(新しく更新された)javascriptやhtml, cssをダウンロードして実行することができる.
このようにして, クライアントに対して新しい機能を提供することができる.
また, 副次的な効能として, クライアントに処理を移譲することで, サーバーの負荷を軽減することができる.

ただし, 複数のブラウザで適切に動作するように, 各ブラウザに対応するコードを用意する必要がある.

### 統一インターフェース
統一インターフェースであることがRESTの原則の一つである.

統一インターフェースとは4つの制約で構成されている.

1. リソースの識別  
リソースをURIを用いて識別することができることを意味する. ここでのリソースとは, サーバーに保存されたデータのことである. また, 最新(lateset), ある日の天気(0401)などもリソースであり, これらはURIで識別されるという制約である.
逆にURIはリソースを識別するためのものであり, 動作を意味するものではない.

1. 表現を用いたリソースの操作  
リソースのある時点での形態を"表現"と表現する. 例えば, JSONやXMLなどが挙げられる. JSONやXMLを用いてクライアントやサーバーがリソースを操作することができる.

1. 自己記述メッセージ  
データ自身がデータの中身を説明することができることを意味する. 例えば, メッセージの中にヘッダーが含まれて, そのヘッダーにメッセージの形式が記述されている.

1. アプリケーション状態のエンジンとしてのハイパーメディア(HATEOAS)
Hypermedia As The Engine Of Application Stateの略である.
レスポンスに現在の状態を踏まえて, 関連するリンクを提供することができることを意味する.
例えば, 検索結果における"次のページ"や"前のページ"のリンクが挙げられる.

インターフェースが共通化されていれば, 異なるブラウザでも同じように表示出来, システムアーキテクチャ全体が簡素化され, 保守性が向上する.

ただし, パフォーマンスが良いとは言えない.

### ステートレス
ステートレスであることがRESTの原則の一つである.

コンテキストに依存せず, サーバーはリクエストを受け取るたびに, そのリクエストに対してのみ応答を返す通信をステートレスという.

通信にはサーバーにコンテキスト情報を保存せず, 状態はクライアント側に保存される.

このような通信ができるようなAPI をステートレスなAPIという.

ステートレスなAPIは, サーバーの負荷を軽減し, サーバーの拡張性を向上させる.
また, 問題が発生した場合には, 単一のリクエストを追えば良いので監視が容易で, リクエストだけ回復すればよいので, システム全体の復旧が容易である.

しかし, リクエストデータに重複を含めなければならず, アプリ側の負担/制御が増える.

### キャッシュ制御
キャッシュ制御であることがRESTの原則の一つである.

クライアント側でレスポンスをキャッシュできるようにするという制約である.

クライアント側でキャッシュを行うことで, サーバーの負担を軽減し, レスポンスタイムを短縮し, ネットワークの負荷を軽減することができる.

ただし, 古いデータを返す可能性があり, キャッシュの有効期限を設定する必要がある.


## REST APIの成熟モデル
REST APIにどれだけ準拠しているかを分類するモデルとして, REST APIの成熟モデルがある.
REST APIの成熟モデルには0から3までの4つの段階がある.

- Level 3: HATEOASを使ったAPI
- Level 2: HTTPメソッドを使ったAPI
- Level 1: リソース指向API
- Level 0: HTTPを使ったAPI

大体level2までがRESTfulなAPIと言われている.
