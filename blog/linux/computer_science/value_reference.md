---
title: '頭がおかしくなる値渡しと参照渡し'
author: "sakakibara"
description: 'Lorem ipsum dolor sit amet'
heroImage: '/blog-placeholder-3.jpg'
pubDate: 2024-08-19
tags: ["値渡し", "参照渡し", "評価戦略"]
---

# Introduction
## Contents
## アタマおかしくなる
コンピュータの処理で最も理解に苦しむ(というか混乱する)概念として値渡しと参照渡しがある.
値渡し, 参照渡しはプログラミング言語の関数の引数の渡し方に関する概念である.
どちらを採用するかは各プログラミングの言語仕様による.
値渡しは(call by value)と呼ばれ, 参照渡しは(call by reference)と呼ばれる.

C言語からプログラミングを始めた人は値渡しを理解するのは容易いが, 参照渡しは理解が難しいだろう. なぜなら, C言語は値渡ししかサポートしていないからだ.
それにC言語ではメモリの動きが直感的に理解しやすいため, 値渡しの概念も理解しやすい.
さらにその上, 値渡し, 参照渡しの概念はプログラミング言語毎にどのように実引数と仮引数を扱うかに関する処理の仕方であるため, コンパイルした結果のアセンブリコードを見てもその違いはわからない場合もある.

例えば, C++の参照渡し`&`を使っても, ポインタを使っても, 最終的に出てくるアセンブリコードは同じになる.

値渡しや参照渡しの概念はメモリの配置云々よりも, 言語の処理に関する概念であるため, より抽象的であるのだ. レイヤーが違うのだ.
値渡しや参照渡しの概念はアセンブリコードに関するより前の, 変数をどのように処理するかが問題になるコンパイルの段階での概念である.
これを実感するのが参照渡しである.

では, どこに値渡しと参照渡しの違いがあるのか.  
そもそも違いが無いならなぜ区別するような概念があるのか.  
どこでこの概念が必要になるのか.  

## 評価戦略
式の値を求めることを**評価**という.  
プログラム中の式をどんな順に評価する方法にはいくつかの戦略がある.  
**値呼び**と**参照呼び**はその中の2つである.

### 値呼び(call by value)
実引数を評価してから仮引数に値をバインドする方法.
つまり, 評価された実引数は仮引数にコピーされる.
そのため, 関数内で引数の値を実際には使わなくても, 引数の式が評価される.
C言語などの多くの言語がこの戦略を採用している.

### 参照呼び(call by reference)
仮引数は実引数そのものになる.
実引数は左辺値を持つ.

### 名前呼び(call by name)
関数内で引数が使われるときに初めて引数の式を評価する方法.
そのため, 引数を使わない場合は引数の式は評価されない. また, 複数回使われる場合は複数回評価される.
C言語のマクロ展開はこの戦略に近い.

### 必要呼び(call by need)
評価結果をキャッシュしておき, 使われるまで評価する回数を最大1回にする方法.
